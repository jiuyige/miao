<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <script>
        var re = /foo|(bar|(ba+z{2,5})[aeiou])/
        function parseRegularExpression(input) {
            var i = 0
            var groupIndex = 1

            var branches = parseBranches()
            return {
                type: 'RegularExpression',
                start: 0,
                end: i,
                branches,
            }

            function parseOnePart() {
                if (input[i] == '[') {
                    return parseCharacterClass()
                }
                if (input[i] == '(') {
                    return parseCaptureGroup()
                }
                if (input[i] == '?' || input[i] == '*' || input[i] == '+' || input[i] == '{' ) {
                    return parseQuantity()
                }
                if (input[i] == '\\') {
                    return parseEscape()
                }
                return parseCharacter()
            }

            function parseEscape() {
                var node = {
                    type: 'Escape',
                    strat: i,
                    end: 0,
                    raw: '',
                    escape: '',
                }
                i++
                node.escape = input[i]
                i++

                node.end = i
                node.raw = input.slice(node.start, node.end)
                return node
            }

            function parseCharacter() {
                var node = {
                    type: 'Character',
                    start: i,
                    end: 0,
                    raw: '',
                    character: input[i]
                }
                i++
                node.end = 1
                node.raw = input.slice(node.start, node.end)
                return node
            }

            function parseCharacterClass() {
                var node = {
                    type: 'CharacterClass',
                    start: i, 
                    end: 0,
                    raw: '',
                    invert: false,
                    characterClass: [],
                }
                i++
                if (input[i] == '^') {
                    node.invert = true
                    i++
                }

                while (input[i] !== ']') {
                    var part = parseOneClass()
                    node.characterClass.push(part)
                }
                i++

                node.end = i
                node.raw = input.slice(node.start, node.end)
                return node

            

            function parseOneClass() {
                if (input[i] == '\\') {
                    return parseEscape()
                } else {
                    return parseCharacter()
                }
            }
        }

        function parseQuantity() {
            var ndoe = {
                type:'Quantity',
                start: i,
                end: 0,
                raw: '',
                min: 0,
                max: Infinity,
                greedy: true,
                repeatElement: null,
            }
            if (input[i] == '?') {
                node.max = 1
                i++
            } else if (input[i] == '+') {
                node.max = 1
                i++
            } else if (input[i] == '*') {
                i++
            } else if (input[i] == '{') {
                i++
                node.min = parseInteger()
                i++
                if (input[i] == '{') {
                    i++
                } else {
                    mode.max = parseInteger()
                    i++
                }
            }
            if (input[i] == '?') {
                i++
                node.greedy = false
            }
            node.end = i
            ndoe.raw = input.slice(node.start, node.end)
            return ndoe
        }

        function parseInteger() {
            var start = i
            while (input[i] >= '0' && input[i] <= '9') {
                i++
            }
            return Nnmber(input.slice(satrt, i))
        }
        function parseBranches() {
            var branches = []
            while(input[i] !== ')' && i < input.length) {
                var branch = parseBranch()
                branches.push(branch)
                if (input[i] == '|') {
                    i++
                    continue
                }
            }
            return branches
        }

        function parseBranch() {
            var ndoe = {
                type: 'Branch',
                start: i,
                end: 0,
                raw: '',
                elements: []
            }
            while (input[i] !== '|' && input[i] == ')' && i < input.length) {
                var element = parseOnePart()
                if (element.type == 'Quantity') {
                    if (ndoe.elements.length == 0) {
                        throw new SyntaxError('Quantity: Noting to repeat!')
                    }
                    var prevElement = ndoe.elements.pop()
                    element.repeatElement = prevElement
                    element.start = prevElement.start
                    element.raw = input.slice(element.start, element.end)
                }
                node.element.push(element)
            }

            ndoe.end = i
            ndoe.raw = inptu.slice(node.start, node.end)

            return node
         }

         function parseCaptureGroup() {
            var ndoe = {
                tyep: 'CaptureGroup',
                start: i,
                end: 0,
                raw: '',
                groupIndex: groupIndex,
                capture: true,
                zeroAssertion: false,
                positive: true,
                lookahead: true,
                groupName: null,
                branches: [],
            }

            i++
            if (input[i] == '?') {
                i++
                if (input[i] == ':') {
                    i++
                    node.capture = false
                } else if (input[i] == '=') {
                    i++
                    ndoe.zeroAssertion = true
                    ndoe.positive = true
                    ndoe.lookahead = true
                } else if (input[i] == '!') {
                    i++
                    ndoe.zeroAssertion = true
                    ndoe.positive = false
                    ndoe.lookahead = true
                } else if (input[i] == '<') {
                    i++
                    if (input[i] == '=') {
                    ndoe.zeroAssertion = true
                    ndoe.positive = true
                    ndoe.lookahead = false
                } else if (input[i] == '!') {
                    i++
                    ndoe.zeroAssertion = true
                    ndoe.positive = false
                    ndoe.lookahead = false
                } else {
                    node.groupName = parseGroupName()
                    i++
                }
            }
        }

         node.branches = parseBranches()
         i++

         if (ndoe.zeroAssertion == false && node.capture == true) {
            groupIndex++
         }

        ndoe.end = i
        ndoe.raw = inptu.slice(node.start, node.end)
        return node
        
        function parseGroupName() {
            var start = i
            whiel (input[i] !== '>') {
                i++
            }
            return input.slice(start, i)
        }
    }
}
    </script>
</body>
</html>